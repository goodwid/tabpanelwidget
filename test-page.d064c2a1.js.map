{"version":3,"sources":["../src/tabpanelwidget.js","index.js"],"names":["debounced","fn","ms","timeout","args","clearTimeout","setTimeout","noop","buffered","_addNoFouc","document","documentElement","classList","add","_install","orig","cb","automatic","contains","parent","parentNode","closest","origVisibility","style","visibility","widget","createElement","i","attributes","length","attr","item","setAttribute","name","value","window","tpwId","id","forceAccordion","forceTabpanel","Error","dynamic","accordion","selectedTabIdx","hxs","shadowHxs","spans","shims","skipB","tablist","setAccordion","v","resizeCheck","innerHTML","remove","removeChild","expandedTabIdxs","insertBefore","idx","hx","span","shim","removeAttribute","shadow","setSelectedTabIdx","wrapFocusTabIdx","focus","toggleExpandedIdx","eventListeners","addEventListener","el","e","handler","push","prevOrigElements","makeShim","last","shimIdx","panel","appendChild","forEach","prevElement","tagName","cloneNode","nextSibling","makeHx","origHx","hxIdx","which","preventDefault","isDl","resizeObserver","child","children","firstChildTagName","test","console","warn","nextChild","nextElementSibling","shadowHx","shadowSpan","map","tab","join","maybeRecomputeLayout","debouncedMaybeRecomputeLayout","bottom","rect","getBoundingClientRect","undefined","ResizeObserver","observe","box","skip","prevFocused","activeElement","firstChild","replaceChild","childUninstalls","uninstalled","querySelectorAll","w","install","uninstall","disconnect","removeEventListener","_areFeaturesSupported","_documentReady","readyState","_runBuffered","autoinstall","Tabpanelwidget"],"mappings":"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","file":"test-page.d064c2a1.js","sourceRoot":"..","sourcesContent":["const debounced = function(fn, ms) {\n  let timeout\n  return function(...args) {\n    if (timeout) clearTimeout(timeout)\n    timeout = setTimeout(() => fn(...args), ms)\n  }\n}\nconst noop = () => {}\nlet buffered = []\n\n// this allows us to do FOUC protection html:not(.no-js):not(.tpw-\\!fouc) .tpw-widget {visibility:hidden}\nfunction _addNoFouc() {\n  document.documentElement.classList.add(\"tpw-!fouc\")\n}\n\n// must alternate heading element(div) heading element.. etc\n// XXX better name for automatic (something about the recursion behavior)\nfunction _install(orig, cb = null, automatic = false) {\n  if (orig.classList.contains(\"tpw-js\")) return cb && cb(noop) // already installed\n  if (automatic) {\n    // wait for parent to automatically install first\n    const parent = orig.parentNode.closest(\".tpw-widget\")\n    if (parent && !parent.classList.contains(\"tpw-js\")) return cb && cb(noop) // recursion will handle us\n  }\n\n  const origVisibility = orig.style.visibility\n  orig.style.visibility = \"hidden\"\n\n  const widget = document.createElement(\"div\")\n  for (let i = 0; i < orig.attributes.length; i++) {\n    const attr = orig.attributes.item(i)\n    widget.setAttribute(attr.name, attr.value)\n  }\n\n  widget.classList.add(\"tpw-widget\")\n  widget.classList.add(\"tpw-js\")\n  if (!window.tpwId) window.tpwId = 0\n  const id = window.tpwId++\n\n  const forceAccordion = orig.classList.contains(\"tpw-accordion\")\n  const forceTabpanel = orig.classList.contains(\"tpw-tabpanel\")\n  if (forceAccordion && forceTabpanel) {\n    throw new Error(\"should only use .tpw-accordion OR .tpw-tabpanel, not both (for dynamic just use .tpw-widget)\")\n  }\n  const dynamic = !(forceAccordion || forceTabpanel)\n\n  const hxs = []\n  const shadowHxs = []\n  const spans = []\n  const shims = []\n  const skipB = document.createElement(\"b\")\n\n  const tablist = document.createElement(\"div\")\n  tablist.setAttribute(\"role\", \"tablist\")\n\n  let accordion\n  function setAccordion(v, resizeCheck) {\n    accordion = v\n    skipB.innerHTML = `Tab through to leave this widget <br />or<br /> Click to go back to the first ${accordion ? \"header\" : \"tab\"}`\n    if (v) {\n      widget.classList.remove(\"tpw-tabpanel\")\n      widget.classList.add(\"tpw-accordion\")\n      if (tablist.parentNode) {\n        tablist.parentNode.removeChild(tablist)\n      }\n    } else {\n      widget.classList.remove(\"tpw-accordion\")\n      widget.classList.add(\"tpw-tabpanel\")\n      if (!resizeCheck) {\n        expandedTabIdxs = {}\n        expandedTabIdxs[selectedTabIdx] = true\n      }\n      widget.insertBefore(tablist, hxs[0]) // so that tpw-shadow stays first\n    }\n    for (let idx = 0; idx < hxs.length; idx++) {\n      const hx = hxs[idx]\n      const span = spans[idx]\n      const shim = shims[idx]\n      if (v) {\n        span.classList.remove(\"tpw-tab\")\n        span.classList.add(\"tpw-header\")\n        span.setAttribute(\"role\", \"button\")\n        span.removeAttribute(\"aria-selected\")\n        // keep tpw-selected on shadow so it is still styled the same as tabpanel would be\n        // if (shadow) shadowHxs[idx].classList.remove(\"tpw-selected\")\n        if (expandedTabIdxs[idx]) {\n          hx.classList.add(\"tpw-selected\")\n          span.setAttribute(\"aria-expanded\", \"true\")\n        } else {\n          hx.classList.remove(\"tpw-selected\")\n        }\n        span.setAttribute(\"tabindex\", \"0\")\n        shim.setAttribute(\"role\", \"region\")\n      } else {\n        span.classList.remove(\"tpw-header\")\n        span.classList.add(\"tpw-tab\")\n        span.setAttribute(\"role\", \"tab\")\n        span.removeAttribute(\"aria-expanded\")\n        if (selectedTabIdx === idx) {\n          span.setAttribute(\"aria-selected\", \"true\")\n          hx.classList.add(\"tpw-selected\")\n          if (shadow) shadowHxs[idx].classList.add(\"tpw-selected\")\n        } else {\n          span.removeAttribute(\"aria-selected\")\n          hx.classList.remove(\"tpw-selected\")\n          if (shadow) shadowHxs[idx].classList.remove(\"tpw-selected\")\n        }\n        span.setAttribute(\"tabindex\", selectedTabIdx === idx ? \"0\" : \"-1\")\n        shim.setAttribute(\"role\", \"tabpanel\")\n      }\n      if ((v && expandedTabIdxs[idx]) || (!v && selectedTabIdx === idx)) {\n        shim.removeAttribute(\"hidden\")\n      } else {\n        shim.setAttribute(\"hidden\", \"\")\n      }\n    }\n    widget.style.visibility = \"visible\"\n  }\n\n  let selectedTabIdx\n  let expandedTabIdxs = {}\n\n  function setSelectedTabIdx(idx) {\n    if (selectedTabIdx != null) {\n      spans[selectedTabIdx].setAttribute(\"tabindex\", \"-1\")\n      spans[selectedTabIdx].removeAttribute(\"aria-selected\")\n      hxs[selectedTabIdx].classList.remove(\"tpw-selected\")\n      if (shadow) shadowHxs[selectedTabIdx].classList.remove(\"tpw-selected\")\n      shims[selectedTabIdx].setAttribute(\"hidden\", \"\")\n    }\n    spans[idx].setAttribute(\"tabindex\", \"0\")\n    spans[idx].setAttribute(\"aria-selected\", \"true\")\n    hxs[idx].classList.add(\"tpw-selected\")\n    if (shadow) shadowHxs[idx].classList.add(\"tpw-selected\")\n    shims[idx].removeAttribute(\"hidden\")\n    selectedTabIdx = idx\n  }\n\n  function wrapFocusTabIdx(idx) {\n    if (idx < 0) {\n      idx = spans.length - 1\n    } else if (idx >= spans.length) {\n      idx = 0\n    }\n    spans[idx].focus()\n  }\n\n  // XXX what is aria-hidden... should we be setting aria-expanded to false instead of removing attribute?\n  // ... remove when switch accordion status\n  function toggleExpandedIdx(idx) {\n    expandedTabIdxs[idx] = !expandedTabIdxs[idx]\n    if (expandedTabIdxs[idx]) {\n      selectedTabIdx = idx // remember last expanded for converting back to tabpanel\n      hxs[idx].classList.add(\"tpw-selected\")\n      spans[idx].setAttribute(\"aria-expanded\", \"true\")\n      shims[idx].removeAttribute(\"hidden\")\n    } else {\n      hxs[idx].classList.remove(\"tpw-selected\")\n      spans[idx].removeAttribute(\"aria-expanded\")\n      shims[idx].setAttribute(\"hidden\", \"\")\n    }\n  }\n\n  const eventListeners = []\n  function addEventListener(el, e, handler) {\n    el.addEventListener(e, handler)\n    eventListeners.push([el, e, handler])\n  }\n\n  let prevOrigElements = []\n  function makeShim(hx, last = false) {\n    if (!hx) return\n    const shimIdx = shims.length\n    const shim = document.createElement(\"div\")\n    shims.push(shim)\n    shim.classList.add(\"tpw-shim\")\n    shim.setAttribute(\"id\", `tpw-${id}-${shimIdx}-p`)\n    shim.setAttribute(\"tabindex\", \"0\")\n    shim.setAttribute(\"hidden\", \"\")\n    shim.setAttribute(\"aria-labelledby\", `tpw-${id}-${shimIdx}-t`)\n    const panel = document.createElement(\"div\")\n    shim.appendChild(panel)\n    panel.classList.add(\"tpw-panel\")\n    prevOrigElements.forEach(prevElement => {\n      if (prevElement.tagName === \"DD\") {\n        panel.innerHTML = prevElement.innerHTML\n      } else {\n        panel.appendChild(prevElement.cloneNode(true))\n      }\n    })\n    if (last) {\n      hx.parentNode.appendChild(shim)\n    } else {\n      hx.parentNode.insertBefore(shim, hx.nextSibling)\n    }\n    prevOrigElements = []\n  }\n\n  // origHx can be dt or h{1,6} tag\n  function makeHx(origHx) {\n    const tagName = origHx.tagName === \"DT\" ? \"div\" : origHx.tagName\n    const hx = document.createElement(tagName)\n    for (let i = 0; i < origHx.attributes.length; i++) {\n      const attr = origHx.attributes.item(i)\n      hx.setAttribute(attr.name, attr.value)\n    }\n    const hxIdx = hxs.length\n    widget.appendChild(hx)\n    hxs.push(hx)\n    hx.classList.add(\"tpw-hx\")\n    // XXX should we recal initial position of tpw-selected and restore it on uninstall?\n    if (origHx.classList.contains(\"tpw-selected\")) {\n      selectedTabIdx = hxIdx\n      expandedTabIdxs[hxIdx] = true\n    }\n    const span = document.createElement(\"span\")\n    spans.push(span)\n    span.innerHTML = origHx.innerHTML\n    hx.appendChild(span)\n    span.setAttribute(\"id\", `tpw-${id}-${hxIdx}-t`)\n    span.setAttribute(\"tabindex\", \"-1\")\n    span.setAttribute(\"aria-controls\", `tpw-${id}-${hxIdx}-p`)\n    addEventListener(span, \"click\", () => {\n      if (accordion) {\n        toggleExpandedIdx(hxIdx)\n      } else {\n        setSelectedTabIdx(hxIdx)\n      }\n    })\n    addEventListener(span, \"focus\", () => {\n      if (!accordion) {\n        setSelectedTabIdx(hxIdx)\n      }\n    })\n    addEventListener(span, \"keydown\", e => {\n      switch (e.which) {\n        case 13: // enter\n        case 32: // space\n          if (accordion) {\n            e.preventDefault()\n            toggleExpandedIdx(hxIdx)\n          }\n          break\n        case 37: // arrow left\n        case 38: // arrow up\n          if (e.which === (accordion ? 38 : 37)) {\n            e.preventDefault()\n            wrapFocusTabIdx(hxIdx - 1)\n          }\n          break\n        case 39: // arrow right\n        case 40: // arrow down\n          if (e.which === (accordion ? 40 : 39)) {\n            e.preventDefault()\n            wrapFocusTabIdx(hxIdx + 1)\n          }\n          break\n      }\n    })\n    return hx\n  }\n\n  let shadow\n  if (dynamic) {\n    shadow = document.createElement(\"div\")\n    shadow.classList.add(\"tpw-shadow\")\n    shadow.setAttribute(\"aria-hidden\", \"true\")\n  }\n\n  // TODO do we want to start with fresh nodes and carry over only what we need so they don't screw things up?\n  // ... maybe they want an attribute or something to target with so need to figure out best thing\n  const isDl = orig.tagName === \"DL\"\n  let child = orig.children[0]\n  const firstChildTagName = child.tagName\n  if (!isDl && !/H[1-6]/.test(firstChildTagName)) {\n    console.warn(\"tabpanelwidget: first child must be heading\")\n    return cb && cb(noop)\n  }\n  let hx\n  while (child) {\n    const nextChild = child.nextElementSibling\n    if (isDl ? child.tagName === \"DT\" : child.tagName === firstChildTagName) {\n      if (hx) makeShim(hx)\n      hx = makeHx(child)\n      if (shadow) {\n        const shadowHx = hx.cloneNode(true)\n        shadowHx.removeAttribute(\"id\")\n        const shadowSpan = shadowHx.children[0]\n        shadowSpan.classList.add(\"tpw-tab\")\n        shadowSpan.removeAttribute(\"aria-controls\")\n        shadowSpan.removeAttribute(\"aria-selected\")\n        shadowSpan.removeAttribute(\"id\")\n        shadowSpan.removeAttribute(\"role\")\n        shadowSpan.removeAttribute(\"tabindex\")\n        shadowHxs.push(shadowHx)\n        shadow.appendChild(shadowHx)\n      }\n    } else {\n      // only allow one element in prevOrigElements for dl\n      if (isDl && (prevOrigElements.length || child.tagName !== \"DD\")) {\n        console.warn(\"tabpanelwidget: dl must have alternating dt, dd\")\n        return cb && cb(noop)\n      }\n      prevOrigElements.push(child)\n    }\n    child = nextChild\n  }\n  makeShim(hx, true)\n\n  tablist.setAttribute(\"aria-owns\", spans.map(tab => tab.id).join(\" \"))\n\n  if (!selectedTabIdx) {\n    selectedTabIdx = 0\n  }\n\n  let resizeObserver\n\n  // if in accordion, can only go into tabpanel if any hx bottom position is different\n  const maybeRecomputeLayout = () => {\n    if (!shadowHxs.length) return\n    let bottom\n    shadowHxs.forEach(shadowHx => {\n      const rect = shadowHx.getBoundingClientRect()\n      if (bottom === undefined) {\n        bottom = rect.bottom\n      } else if (bottom !== rect.bottom) {\n        bottom = null\n      }\n    })\n    setAccordion(bottom === null)\n  }\n  const debouncedMaybeRecomputeLayout = debounced(maybeRecomputeLayout, 100)\n\n  if (dynamic) {\n    // XXX optimize to just make one of these handlers for all tpws (instead of per widget)\n    resizeObserver = new window.ResizeObserver(debouncedMaybeRecomputeLayout)\n    resizeObserver.observe(widget, {box: \"border-box\"})\n    spans.forEach(span => resizeObserver.observe(span, {box: \"border-box\"}))\n  } else {\n    setAccordion(forceAccordion)\n  }\n\n  const skip = document.createElement(\"a\")\n  skip.classList.add(\"tpw-skip\")\n  skip.setAttribute(\"tabindex\", \"-1\")\n  skip.setAttribute(\"href\", `#tpw-${id}-0-t`)\n  skip.appendChild(skipB)\n  widget.appendChild(skip)\n\n  let prevFocused\n  addEventListener(widget, \"keydown\", e => {\n    switch (e.which) {\n      case 27: // escape\n        if (document.activeElement === skip) {\n          (prevFocused || widget).focus()\n        } else {\n          prevFocused = document.activeElement\n          skip.focus()\n        }\n        break\n      case 35: // end\n        e.preventDefault()\n        spans[spans.length - 1].focus()\n        break\n      case 36: // home\n        e.preventDefault()\n        spans[0].focus()\n        break\n    }\n  })\n\n  if (dynamic) {\n    widget.insertBefore(shadow, widget.firstChild)\n  }\n\n  orig.parentNode.replaceChild(widget, orig)\n  orig.style.visibility = origVisibility\n\n  const childUninstalls = []\n  if (automatic) {\n    const childWidgets = widget.querySelectorAll(\".tpw-widget\")\n    childWidgets.forEach(w => childUninstalls.push(install(w, true)))\n    // XXX ideally we want to do this when all widgets have been replaced after first pass\n    _addNoFouc()\n  }\n\n  // XXX ensure no closure leakagages (even elsewhere)\n  let uninstalled\n  return cb && cb(() => {\n    if (uninstalled) return\n    childUninstalls.forEach(uninstall => uninstall())\n    if (resizeObserver) resizeObserver.disconnect()\n    window.removeEventListener(\"resize\", debouncedMaybeRecomputeLayout)\n    eventListeners.forEach(([el, e, handler]) => el.removeEventListener(e, handler))\n    widget.parentNode.replaceChild(orig, widget)\n    uninstalled = true\n  })\n}\n\nfunction _areFeaturesSupported() {\n  // XXX improve this\n  return !!window.ResizeObserver\n}\n\nfunction _documentReady() {\n  return document.readyState !== \"loading\"\n}\n\nfunction _runBuffered() {\n  if (_areFeaturesSupported()) {\n    if (_documentReady()) {\n      buffered.forEach(fn => fn())\n      buffered = []\n    }\n  } else {\n    // dont want to end up with visibility:hidden (if they don't load polyfill)\n    // so just disable fouc protection in that case\n    _addNoFouc()\n  }\n}\n\nfunction install(...args) {\n  buffered.push(() => _install(...args))\n  _runBuffered()\n}\n\nfunction autoinstall() {\n  buffered.push(() => {\n    document.querySelectorAll(`.tpw-widget`).forEach(w => _install(w, null, true))\n  })\n  _runBuffered()\n}\n\nif (document.readyState == 'loading') {\n  document.addEventListener(\"DOMContentLoaded\", () => {\n    _runBuffered()\n  })\n}\n\nexport {\n  install, // no longer returns install, but returns promise that resolves to uninstall\n  autoinstall,\n  _runBuffered, // this is exported but just used by polyfill... so we don't have to poll\n}\n","import * as Tabpanelwidget from \"../src/tabpanelwidget.js\"\n\n// XXX make sure this happens before we do vue and react so we don't try to do those\nTabpanelwidget.autoinstall()\n"]}